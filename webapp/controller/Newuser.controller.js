sap.ui.define(["sap/ui/core/mvc/Controller"], function (Controller) {
	"use strict";
	return Controller.extend("cognitivepp.CognitiveApp.controller.Newuser", {
		/**
		 * Called when a controller is instantiated and its View controls (if available) are already created.
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.
		 * @memberOf cognitivepp.CognitiveApp.view.Newuser
		 */
		onInit: function () {},
		/**
		 *@memberOf cognitivepp.CognitiveApp.controller.Newuser
		 */
		validate_email: function (oEvent) {
			//This code was generated by the layout editor.
			var mailregex = /^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;
			var lvEmail = this.byId("idEmail").getValue();
			if (!lvEmail) {
				this.byId("idEmail").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idEmail").setValueStateText("Enter Email");
			} else {
				this.byId("idEmail").setValueState(sap.ui.core.ValueState.None);
				if (!mailregex.test(lvEmail)) {
					this.byId("idEmail").setValueState(sap.ui.core.ValueState.Error);
					this.byId("idEmail").setValueStateText("Enter valid Email");
				}
			}
		},
		validate_password: function (oEvent) {
			//This code was generated by the layout editor.
			var lvPassword = this.byId("idPassword").getValue();
			if (!lvPassword) {
				this.byId("idPassword").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idPassword").setValueStateText("Enter Password");
			} else {
				this.byId("idPassword").setValueState(sap.ui.core.ValueState.None);
			}
		},
		validate_confirm: function (oEvent) {
			//This code was generated by the layout editor.
			var lvPassword = this.byId("idPassword").getValue();
			var lvConfirm = this.byId("idConfirm").getValue();
			if (!lvConfirm) {
				this.byId("idConfirm").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idConfirm").setValueStateText("Re-enter Password");
			} else {
				this.byId("idConfirm").setValueState(sap.ui.core.ValueState.None);
				if (lvConfirm != lvPassword) {
					this.byId("idConfirm").setValueState(sap.ui.core.ValueState.Error);
					this.byId("idConfirm").setValueStateText("Password does not match");
				}
			}
		},
		validate_vendor: function (oEvent) {
			//This code was generated by the layout editor.
			var lvVendor = this.byId("idVendor").getValue();
			if (!lvVendor) {
				this.byId("idVendor").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idVendor").setValueStateText("Enter Vendor");
			} else {
				this.byId("idVendor").setValueState(sap.ui.core.ValueState.None);
			}
		},
		validate_fname: function (oEvent) {
			//This code was generated by the layout editor.
			var lvFname = this.byId("idFname").getValue();
			if (!lvFname) {
				this.byId("idFname").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idFname").setValueStateText("Enter First Name");
			} else {
				this.byId("idFname").setValueState(sap.ui.core.ValueState.None);
			}
		},
		validate_lname: function (oEvent) {
			var lvLname = this.byId("idLname").getValue();
			if (!lvLname) {
				this.byId("idLname").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idLname").setValueStateText("Enter last Name");
			} else {
				this.byId("idLname").setValueState(sap.ui.core.ValueState.None);
			}
		},
		
		validate_cname: function (oEvent) {
			var lvCname = this.byId("idCname").getValue();
			if (!lvCname) {
				this.byId("idCname").setValueState(sap.ui.core.ValueState.Error);
				this.byId("idCname").setValueStateText("Enter Company Name");
			} else {
				this.byId("idCname").setValueState(sap.ui.core.ValueState.None);
			}
		},
		
		/**
		 *@memberOf cognitivepp.CognitiveApp.controller.Newuser
		 */
		onSave: function (oEvent) {
			//This code was generated by the layout editor.
			
			var oGlobalBusyDialog = new sap.m.BusyDialog();
			oGlobalBusyDialog.open();
			
			var lvEmail = this.byId("idEmail").getValue();
			var lvPassword = this.byId("idPassword").getValue();
			var lvVendor = this.byId("idVendor").getValue();
			var lvLname = this.byId("idLname").getValue();
			var lvFname = this.byId("idFname").getValue();
			var lvCname = this.byId("idCname").getValue();
//			"id": 100,
			var newuser = JSON.stringify({ 
										  "email": lvEmail ,
										  "password": lvPassword,
										  "vendorid": lvVendor,
										  "firstname": lvFname,
										  "lastname": lvLname,
										  "companyname": lvCname
										 
										});
//			 "additionalProp1": {}
			
			var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
			var sUrl2 = "http://localhost:3000/signup/";
			jQuery.ajax({
				type: "POST",
				url: sUrl2,
				data: newuser,
				contentType: "application/json",
				error: function (jqXHR, textStatus, errorThrown) {
					var sMessage = jqXHR.status + " " + jqXHR.statusText + " " + jqXHR.responseText;
					jQuery.sap.log.error("Error while Saving user:", sMessage, "index.html");
	//				sap.m.MessageToast.show(errorThrown);
					oGlobalBusyDialog.close();
					sap.m.MessageBox.show(JSON.parse(jqXHR.responseText).error.message);
				},
				success: function (oData, status, jqXHR) {
					oGlobalBusyDialog.close();
					sap.m.MessageToast.show("User Created..");
					oRouter.navTo("login");
				}
			});
		}
	});
});